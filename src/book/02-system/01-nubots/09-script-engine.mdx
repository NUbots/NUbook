---
section: System
chapter: NUbots
title: Script Engine
description: Describes how the script engine works.
slug: /system/nubots/script-engine
---

Scripts are static motions for the robot. They specify what joint angles to move to and how long the robot should take to go to those joint positions. For example, standing up is a very basic script telling the robot to move their joints to the stand position over a one second time period. There can be many of these position specifications in a row to make the robot do more complex movements like getting up or kicking.

To execute scripts, we emit and receive messages describing the script. These are specified in [Script.h](https://github.com/NUbots/NUbots/blob/master/shared/extension/Script.h) as [ExecuteScriptByName](https://github.com/NUbots/NUbots/blob/96357855b059cd499021552b3e25a4b158828dc5/shared/extension/Script.h#L224) and [ExecuteScript](https://github.com/NUbots/NUbots/blob/96357855b059cd499021552b3e25a4b158828dc5/shared/extension/Script.h#L261).

`ExecuteScriptByName` takes

- a subsumption ID
- the name of the script/s as a string or a vector of strings
- the duration of the scripts
- the time that these scripts should start executing

An example of receiving is in [ScriptEngine.cpp](https://github.com/NUbots/NUbots/blob/96357855b059cd499021552b3e25a4b158828dc5/module/motion/ScriptEngine/src/ScriptEngine.cpp#L51).

```cpp
on<Trigger<ExecuteScriptByName>>().then([this](const ExecuteScriptByName& command) {...}
```

An example of an emission is in [KickScript.cpp](https://github.com/NUbots/NUbots/blob/96357855b059cd499021552b3e25a4b158828dc5/module/behaviour/skills/KickScript/src/KickScript.cpp#L102)

```cpp
emit(std::make_unique<ExecuteScriptByName>(
    id, std::vector<std::string>({"Stand.yaml", "KickRight.yaml", "Stand.yaml"})));
```

Note these are only the names of the scripts, not the full paths. The names correspond to the names of YAML files in the [scripts folder](https://github.com/NUbots/NUbots/tree/master/module/motion/ScriptEngine/data/scripts).

Rather than using the name of a script, we can also use a [Script type](https://github.com/NUbots/NUbots/blob/96357855b059cd499021552b3e25a4b158828dc5/shared/extension/Script.h#L43) directly. `Script` contains all the information for the script. We use the message `ExecuteScript` to send these Scripts. `ExecuteScript` takes

- a subsumption ID
- a Script or vector of Scripts
- the duration of the scripts
- the time that these scripts should start executing

It can be received by using an on statement as seen in [ScriptEngine.cpp](https://github.com/NUbots/NUbots/blob/96357855b059cd499021552b3e25a4b158828dc5/module/motion/ScriptEngine/src/ScriptEngine.cpp#L71)

```cpp
on<Trigger<ExecuteScript>>().then([this](const ExecuteScript& command) {...}
```

An example of an emission is in [ScriptTuner.cpp](https://github.com/NUbots/NUbots/blob/96357855b059cd499021552b3e25a4b158828dc5/module/behaviour/tools/ScriptTuner/src/ScriptTuner.cpp#L590)

```cpp
emit(std::make_unique<ExecuteScript>(id, script, NUClear::clock::now()));
```

The [ScriptEngine](https://github.com/NUbots/NUbots/tree/master/module/motion/ScriptEngine) module receives either of these messages and processes the information for the script. It collects the servo positions and time for each frame and modifies them if needed based on the given duration and start time in the message. The information is then emitted as a [ServoCommand](https://github.com/NUbots/NUbots/blob/master/shared/message/behaviour/ServoCommand.proto) message.

The script files are YAML files of the following format.

```yaml
- duration: 1000
  targets:
    - id: HEAD_YAW
      position: 0
      gain: 30
      torque: 100
    - id: HEAD_PITCH
      position: 0.5
      gain: 30
      torque: 100
    - id: R_HIP_YAW
      position: -0.03
      gain: 30
      torque: 100
```

These script files are in the ScriptEngine module. Scripts can be specific to a robot. More on scripts can be found on the [Configuration and Script System](/system/nubots/config-script) page.
