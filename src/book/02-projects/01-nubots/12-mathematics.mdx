---
section: Projects
chapter: NUbots
title: Mathematics
description: Detailed explanation of the mathematics used in the NUbots codebase.
slug: /projects/nubots/mathematics
---

The NUbots codebase uses specific mathematical concepts and notation that is relevant to the field of robotics. This page details these concepts and notations. In the NUbots codebase there are many transforms between spaces. Specific notation is used for these transforms for better readability.

## Bases

A **basis** is a maximal set of linearly independent vectors.

If the vectors in the basis are mutually perpendicular, then they are **orthogonal**.

An **orthonormal basis (ONB)** is a basis which is orthogonal and each vector has length 1.

## Vectors

Any vector $\mathbf{r}$ can be expressed as a linear combination of the elements of a basis:

$$
\mathbf{r} = r_1^a \mathbf{a_1} + r_2^a \mathbf{a_2} + r_3^a \mathbf{a_3}
$$

The scalars are the **coordinates** for the vector in the basis $a$.

In the NUbots codebase, vectors are written as `rABb` which denotes a vector from point $B$ to point $A$ in the basis (or **space**) $b$. These are column matrices of the coordinates of the vectors:

$$
\mathbf{r}^a = \begin{bmatrix}
r_1^a \\
r_2^a \\
r_3^a \end{bmatrix}
$$

To make computations such as inner product or cross product with coordinates, they must be relative to the same basis.

So far we have expressed vectors as three dimensional vectors. However, they are really four dimensional. A vector is defined as $(x, y, z, 0)$. A point is expressed as $(x, y, z, 1)$. A vector is a direction and length, whereas a point is a position.

## Rotations

To describe the motion of the robot, we need a **reference frame** and a **coordinate system**.

The reference frame is the physical rigid body and the coordinate system is a mathematical concept, which is represented as a basis.

**Rotations** are defined by a 3x3 matrix. If we have a vector $\mathbf{r}^a$, that is the vector $r$ in the coordinate system $a$, the rotation

$$
\begin{bmatrix}
\cos(\psi) & -\sin(\psi) & 0 \\
\sin(\psi) & \cos(\psi) & 0 \\
0 & 0 & 1 \end{bmatrix}
$$

will rotate $\mathbf{r}^a$ by $\psi$ around the coordinate axis $\mathbf{a_3}$.

The orientation of the basis $b$ relative to $a$ can be described by three consecutive rotations about the main axis. There are 12 different orders to do these rotations in, and each triplet of rotated angles is called a set of **Euler angles**. In robotics, the triplet is **yaw**, **pitch** and **roll** (Z-Y-X).

In the NUbots codebase, we denote a rotation matrix from space $b$ to space $a$ as `Rab`.

The rotation matrices belong to the **special orthogonal group of order 3**. These all have the following properties:

$$
\mathbf{R}^{-1} = \mathbf{R}^T
$$

$$
\text{det}(\mathbf{R}) = 1
$$

If we have a vector $\mathbf{r}$ (which goes from point C to point D) in a space $a$ and we want to rotate it from space $a$ to space $b$, we write:

$$
\mathbf{r}^b_{CD} = \mathbf{R}^b_a \cdot \mathbf{r}^a_{CD}
$$

This is written in the NUbots codebase as `rCDb = Rba * rCDa`.

## Homogeneous Transformations

A transformation matrix in three dimensions is a 4x4 matrix containing a **rotation** component and a **translation** component.

If we have some rotation $\mathbf{R}_a^b$ and a translation component $\mathbf{r}^b_{AB}$, then we have a transformation matrix that transforms from space $a$ to space $b$:

$$
\mathbf{H}_a^b = \begin{bmatrix}
\mathbf{R}_a^b & \mathbf{r}_{AB}^b \\
\mathbf{0} & 1
\end{bmatrix}
$$

This is written in the NUbots codebase as `Hba`.

The vector $\mathbf{r}_{AB}^b$ is the vector from B (the origin of space b) to A (the origin of space a) in b space, which would be written in the codebase as `rABb`.

The reason for this is that if we apply the transform $H^b_a$ to some point $\rho^a$, then $\rho^a$ will first be rotated by $R_a^b$, giving $\rho^b$. $\rho^b$ will then be translated by some vector according to the transformation matrix. Since $\rho^b$ is now rotated in the $b$ coordinate system, the translation vector must also be in this $b$ coordinate system. The vector is from B to A because a point (0, 0, 0) in space $a$ should be moved to the origin of $a$ in $b$ space after transformation. Thus, the translation vector is $\mathbf{r}_{AB}^b$.

Transformation matrices left multiply with vectors to get a vector in the new space.

$$
\mathbf{r}^b = \mathbf{H}^b_a \cdot \mathbf{r}^a
$$

This is written in the codebase as `rCDb = Hba * rCDa`, if $\mathbf{r}$ represents a vector from point D to point C.

They also multiply together to get a new transformation matrix.

$$
\mathbf{H}_a^c = \mathbf{H}_b^c \cdot \mathbf{H}^b_a
$$

This is written in the codebase as `Hca = Hcb * Hba`.

## Velocity

Velocity of some object is represented relative to some space. If we have the velocity of object A moving relative to space b, then we write this in the codebase as `vAb`.

## Examples

If you have a transformation matrix `Htw` and you want the matrix `Hwt`, this is can be achieved by calling `Htw.inverse()`. The inverse function swaps the letter order. The returned inverse matrix is not mutable.

If you have a vector `rTWa` and you want the opposite letter order, this is done by negating the vector, `rWTa = -rTWa`. Note that negating does not change the space it is measured in!

If you have two transformation matrices and you would like to multiply them to get a new transformation matrix, the inner two letters should be identical, ie the same space.

```cpp
Eigen::Affine3d Hac = Hab * Hbc
```

These two inner letters are canceled, with the outer two remaining. This also works for rotation matrices.

If you have two vectors in the same space and their inner letters are both the same, then they can be canceled in a similar way to the transformation matrices.

```cpp
Eigen::Vector3d rXZa = rXYa + rYZa;
```

## Summary

| Item                | Description                                                                  |
| ------------------- | ---------------------------------------------------------------------------- |
| Hab                 | Denotes a 3D affine transformation matrix going from space $b$ to space $a$. |
| Rab                 | Denotes a 3D rotation matrix from space $b$ to space $a$.                    |
| rABb                | Denotes a vector from point $B$ to point $A$ in space $a$.                   |
| vAB                 | The velocity of $A$ in space $b$.                                            |
| rXZa = rXYa + rYZa  | Create a new vector from two other vectors.                                  |
| rACc = Hcb \* rABb  | Changing a vector from one space to another using a homogeneous transform.   |
| rABd = Rdc \* rABc  | Changing a vector from one space to another using a rotation transform       |
| Hba = Hab.inverse() | Inverting a matrix swaps the letter order.                                   |
| Hac = Hab \* Hbc    | Creating a new transform from two other transforms.                          |
| Euler Angles        | Are of the form Z-Y-X.                                                       |

## Useful Links

[Essence of Linear Algebra by 3blue1brown](https://www.3blue1brown.com/essence-of-linear-algebra-page)
