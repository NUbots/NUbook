---
section: Guides
chapter: Main Codebase
title: Recording and Playback
description: Recording data and playing it back.
slug: /guides/main/recording-playback
---

NUbots data is stored in [NUClear Binary Stream (NBS) files](/system/foundations/nuclear#nbs-files). Any [messages](https://github.com/NUbots/NUbots/tree/master/shared/message) that are passed around the NUbots system can be recorded.

## Recording Data

The following steps detail how to record data. An example will be given throughout involving recording sensors messages.

1. Set up the role. Most of the time this involves making minor changes to an existing role.

   1. The role must contain the module/s which emit the message/s you want to record.
   2. The role must contain the module `support::logging::DataLogging`.

   For example, you may want to record [Sensors](https://github.com/NUbots/NUbots/blob/master/shared/message/input/Sensors.proto) messages. You could use the existing [sensortest](https://github.com/NUbots/NUbots/blob/master/roles/sensortest.role) role and add `support::logging::DataLogging` to it.

2. Build the code and install it to a robot. To find out how to do this, visit the [Getting Started](/guides/nubots/getting-started) page.

3. Make changes to the `DataLogging.yaml` configuration file.

   1. On the robot, open the file in an editor: `nano config/DataLogging.yaml`. If you are in Docker, you will need to open it using the **b** script: `./b edit config/DataLogging.yaml`.
   2. List all messages you would like to record in the file. In our example, we would want to list `input::sensors` in the file.
   3. Save and exit.

4. Run the binary. In our example, this would be `./sensortest`.

5. Stop the binary when you have finished recording by pressing <kbd>CTRL</kbd> + <kbd>c</kbd>.

6. Move the newly created NBS file to a computer for safe storage.
   1. The NBS file will be located on the robot in the `log/role_name/` folder. The name will correspond to the time and date it was created, according to the robot's clock. Make note of the name. In our example, this may be `log/sensortest/18072020T082100.nbs`.
   2. Copy the file across. On the destination computer, run `scp nubots@<address>:log/role_name/file_name path/to/destination`. In our example, we may want to run `scp nubots@<address>:log/sensortest/18072020T082100.nbs .`. The file will then be copied to the folder you ran the command in. `<address>` corresponds to the address of the robot.

## Extracting Data

The NBS file is not easily understood by humans. Certain tools in the NUbots codebase convert NBS files to file formats that are easier for us to understand.

The tools are run with the **b** script in the NUbots codebase. [NBS tools](https://github.com/NUbots/NUbots/tree/master/tools/nbs) have the argument `nbs`.

Tools are executed by running

```sh
./b nbs <tool_name> <nbs_file_name> <arguments>
```

### Stats

Decodes an NBS file into a series of file statistics.

| Argument            | Definition                                                        |
| ------------------- | ----------------------------------------------------------------- |
| --message-timestamp | Uses the message's `.timestamp` field as the time of the message. |

### JSON

Outputs the data in the NBS file to a JSON file. It is useful to redirect the output to a file by appending `> file.json` to the command.

### Extract Images

Decodes an NBS file and extracts any compressed jpeg files into jpeg files.

| Argument | Definition                                  | Default                       |
| -------- | ------------------------------------------- | ----------------------------- |
| --output | Specifies the folder to save the images to. | The current working directory |

### Video

This will take images in an NBS file and create a video.

| Argument  | Definition                                            | Default                       |
| --------- | ----------------------------------------------------- | ----------------------------- |
| --output  | Specifies the folder to save the video to.            | The current working directory |
| --quality | Specifies the quality to save the video in.           | 30M                           |
| --encoder | specifies the encoder to use when encoding the video. | h264_nvenc                    |

### Calibrate Cameras

Calculate camera intrinsics using an NBS recording of asymmetric circles grid patterns.

| Argument        | Definition                                                           | Default  |
| --------------- | -------------------------------------------------------------------- | -------- |
| --config        | The path to the directory containing the camera configuration files. | Required |
| --rows          | The number of rows in the asymmetric circles grid.                   | 4        |
| --cols          | The number of columns in the asymmetric circles grid.                | 11       |
| --grid_size     | The distance between rows/cols in the grid in meters.                | 0.04     |
| -- no-intrisics | Does not change the intrinsic configuration values.                  | -        |
| --no-extrinsics | Does not change the extrinsic configuration values.                  | -        |

### Foot Down

Trains a foot down network using sensor data from the legs.

## Playing Back Data

Messages can be emitted from an NBS file. When using prerecorded data, ensure you remove the modules in the role which emit those message types that you would like to emit from the NBS file, otherwise you will get potentially conflicting data. The role file must include `support::logging::DataPlayback`.
